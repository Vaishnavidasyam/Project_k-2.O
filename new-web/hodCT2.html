<!-- assign_faculty.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assign Faculty to Subjects</title>
    <link rel="stylesheet" href="styles7.css" />
    <link rel="icon" href="pic.png" type="image/png" />
    <style>
      /* Container */
      .header {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 5%;
        background: gray; /* changed to gray */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
      }
      .back,
      .add-btn,
      .save-btn {
        background: gray; /* ensure all primary buttons are gray */
        color: white;
      }

      .back:hover,
      .add-btn:hover,
      .save-btn:hover {
        background: #555;
      }

      /* Adjust body padding to prevent content hiding under header */
      body {
        padding-top: 80px;
        background: url("back.jpg") no-repeat center center fixed; /* set background image */
        background-size: cover;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        color: #333;
      }

      /* Container */

      /* Logo */
      .logo {
        display: flex;
        align-items: center;
        font-size: 1.5em;
      }
      .logo-icon {
        height: 40px;
        margin-right: 10px;
        background: none;
      }
      /* Navigation Links */
      .nav-links {
        display: flex;
        justify-content: flex-end;
        gap: 40px;
      }

      .nav-links a {
        text-decoration: none;
        color: white;
        transition: color 0.3s, transform 0.2s;
        font-size: 1.1em;
        font-weight: 500;
        text-transform: uppercase;
      }

      .nav-links a:hover {
        color: #444;
        transform: scale(1.1);
      }
      .container {
        max-width: 700px;
        margin: 20px auto; /* Adjusted for header */
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      h2 {
        font-size: 1.8em;
        margin-bottom: 20px;
        color: #343a40;
      }

      /* Table Styling */
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }

      th,
      td {
        border: 1px solid #ccc;
        padding: 10px 15px;
        text-align: left;
        font-size: 1em;
      }

      th {
        background-color: #e9ecef; /* Lighter header background */
        font-weight: bold;
        color: #495057; /* Darker text color for contrast */
      }

      tr:nth-child(odd) {
        background-color: #f9f9f9; /* Light row color */
      }

      tr:nth-child(even) {
        background-color: #f1f1f1; /* Slightly darker alternate row */
      }

      tr:hover {
        background-color: #e2e6ea; /* Hover effect for rows */
      }

      /* Button Styles */
      .buttons {
        display: flex;
        justify-content: space-between;
        gap: 15px;
      }
      .buttons button {
        padding: 10px 20px;
        font-size: 1em;
        cursor: pointer;
        border: none;
        border-radius: 4px;
        background: gray; /* all buttons gray */
        color: white;
        transition: background 0.3s ease;
      }
      .buttons button:hover {
        background: #686868; /* darker on hover */
      }

      /* Popup Overlay */
      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .popup-overlay.active {
        display: flex;
      }

      .popup-content {
        background-color: #fff;
        padding: 30px;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        position: relative;
        text-align: left;
      }

      .popup-close {
        position: absolute;
        top: 12px;
        right: 16px;
        font-size: 24px;
        background: none;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="logo">
        <img src="icon.png" alt="Logo" class="logo-icon" />
        𝑼𝒏𝒊𝒗𝒆𝒓𝒔𝒊𝒕𝒚 𝑴𝒂𝒏𝒂𝒈𝒆𝒎𝒆𝒏𝒕 𝑺𝒚𝒔𝒕𝒆𝒎
      </div>
      <nav class="nav-links">
        <a href="first.html">𝑯𝒐𝒎𝒆</a>
        <a href="javascript:void(0)" onclick="openModal('aboutModal')">𝑨𝒃𝒐𝒖𝒕</a>
        <a href="javascript:void(0)" onclick="openModal('contactModal')"
          >𝑪𝒐𝒏𝒕𝒂𝒄𝒕</a
        >
        <a onclick="logout()">𝑳𝒐𝒈𝒐𝒖𝒕</a>
      </nav>
    </header>

    <!-- About Modal -->
    <div id="aboutModal" class="popup-overlay">
      <div class="popup-content">
        <button class="popup-close" onclick="closeModal('aboutModal')">
          ×
        </button>
        <h2>𝑨𝒃𝒐𝒖𝒕 𝑻𝒉𝒊𝒔 𝑾𝒆𝒃𝒔𝒊𝒕𝒆</h2>
        <p>
          𝙏𝙞𝙢𝙚𝙏𝙖𝙗𝙡𝙚 𝙈𝙖𝙣𝙖𝙜𝙚𝙢𝙚𝙣𝙩 𝙎𝙮𝙨𝙩𝙚𝙢 𝙨𝙞𝙢𝙥𝙡𝙞𝙛𝙞𝙚𝙨 𝙩𝙝𝙚 𝙥𝙧𝙤𝙘𝙚𝙨𝙨 𝙤𝙛 𝙩𝙞𝙢𝙚𝙩𝙖𝙗𝙡𝙚
          𝙘𝙧𝙚𝙖𝙩𝙞𝙤𝙣 𝙖𝙣𝙙 𝙚𝙣𝙝𝙖𝙣𝙘𝙚𝙨 𝙩𝙝𝙚 𝙤𝙫𝙚𝙧𝙖𝙡𝙡 𝙖𝙘𝙖𝙙𝙚𝙢𝙞𝙘 𝙚𝙭𝙥𝙚𝙧𝙞𝙚𝙣𝙘𝙚 𝙛𝙤𝙧 𝙨𝙩𝙪𝙙𝙚𝙣𝙩𝙨 𝙖𝙣𝙙
          𝙛𝙖𝙘𝙪𝙡𝙩𝙮. 𝙏𝙝𝙞𝙨 𝙥𝙖𝙜𝙚 𝙨𝙚𝙧𝙫𝙚𝙨 𝙖𝙨 𝙩𝙝𝙚 𝙨𝙩𝙖𝙧𝙩𝙞𝙣𝙜 𝙞𝙣𝙩𝙚𝙧𝙛𝙖𝙘𝙚 𝙬𝙞𝙩𝙝 𝙣𝙖𝙫𝙞𝙜𝙖𝙩𝙞𝙤𝙣
          𝙖𝙣𝙙 𝙖𝙪𝙩𝙝𝙚𝙣𝙩𝙞𝙘𝙖𝙩𝙞𝙤𝙣 𝙛𝙚𝙖𝙩𝙪𝙧𝙚𝙨.
        </p>
      </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="popup-overlay">
      <div class="popup-content">
        <button class="popup-close" onclick="closeModal('contactModal')">
          ×
        </button>
        <h2>𝑪𝒐𝒏𝒕𝒂𝒄𝒕 𝑼𝒔</h2>
        <p>
          <strong>𝑬𝒎𝒂𝒊𝒍:</strong> 𝒔𝒉𝒂𝒊𝒌𝒇𝒂𝒚𝒂𝒛73822@𝒈𝒎𝒂𝒊𝒍.𝒄𝒐𝒎<br />
          <strong>𝑷𝒉𝒐𝒏𝒆:</strong> 7382259565<br />
          <strong>𝑨𝒅𝒅𝒓𝒆𝒔𝒔:</strong> 𝑲𝒖𝒌𝒂𝒕𝒑𝒂𝒍𝒍𝒚, 𝑯𝒚𝒅𝒆𝒓𝒂𝒃𝒂𝒅, 𝑰𝒏𝒅𝒊𝒂<br />
          <strong>𝑭𝒐𝒍𝒍𝒐𝒘 𝒖𝒔:</strong> 𝑭𝒂𝒄𝒆𝒃𝒐𝒐𝒌 | 𝑻𝒘𝒊𝒕𝒕𝒆𝒓 | 𝑰𝒏𝒔𝒕𝒂𝒈𝒓𝒂𝒎
        </p>
      </div>
    </div>

    <div class="container">
      <h2>𝑨𝒔𝒔𝒊𝒈𝒏 𝑭𝒂𝒄𝒖𝒍𝒕𝒚 𝒕𝒐 𝑺𝒖𝒃𝒋𝒆𝒄𝒕𝒔</h2>
      <table id="assignTable">
        <thead>
          <tr>
            <th>𝑺𝒖𝒃𝒋𝒆𝒄𝒕</th>
            <th>𝑭𝒂𝒄𝒖𝒍𝒕𝒚</th>
          </tr>
        </thead>
        <tbody>
          <!-- JS will inject rows here -->
        </tbody>
      </table>

      <div class="buttons">
        <button class="cancel-btn" onclick="goBack()">
          <img src="backs.png" alt="Back" class="btn-icon" />𝑩𝒂𝒄𝒌
        </button>
        <button class="save-btn" onclick="saveAssignments()">
          <img src="save.png" alt="Save" class="btn-icon" />𝑺𝒂𝒗𝒆
        </button>
      </div>
    </div>

    <script>
      // Modal handlers
      function openModal(id) {
        document.getElementById(id).classList.add("active");
      }
      function closeModal(id) {
        document.getElementById(id).classList.remove("active");
      }
      // Close when clicking outside content
      window.addEventListener("click", (e) => {
        ["aboutModal", "contactModal"].forEach((id) => {
          const modal = document.getElementById(id);
          if (e.target === modal) closeModal(id);
        });
      });

      // Existing faculty‐assignment script below...

      let facultiesList = [];

      document.addEventListener("DOMContentLoaded", () => {
        fetchSubjects()
          .then(fetchFaculties)
          .then(fetchAssignments)
          .catch(console.error);
      });

      function fetchSubjects() {
        const p = new URLSearchParams(location.search);
        return fetch(
          `fetch_subjects.php?semester=${p.get("semester")}&class=${p.get(
            "class"
          )}&department=${p.get("department")}&room=${p.get("room")}`
        )
          .then((r) => r.json())
          .then((subjects) => {
            const tbody = document.querySelector("#assignTable tbody");
            subjects.forEach((subj) => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${subj}</td>
                <td class="faculty-assignment">
                  <select data-subject="${subj}">
                    <option value="">Select Faculty</option>
                  </select>
                  <input type="checkbox" onchange="toggleAdditionalFaculty(this)">
                  <div class="additional-faculties" style="display:none;">
                    <select><option value="">Select Faculty</option></select>
                  </div>
                </td>`;
              tbody.appendChild(tr);
            });
          });
      }

      function fetchFaculties() {
        return fetch("get_faculties.php")
          .then((r) => r.json())
          .then((faculties) => {
            facultiesList = faculties;
            document.querySelectorAll("#assignTable select").forEach((sel) => {
              sel.innerHTML = '<option value="">Select Faculty</option>';
              facultiesList.forEach((f) => sel.add(new Option(f, f)));
            });
          });
      }

      function fetchAssignments() {
        const p = new URLSearchParams(location.search);
        return fetch(
          `fetch_assignments.php?semester=${p.get("semester")}&class=${p.get(
            "class"
          )}&department=${p.get("department")}&room=${p.get("room")}`
        )
          .then((r) => r.json())
          .then((assignments) => {
            assignments.forEach((a) => {
              const [first, second] = a.faculty.split(",");
              const sel = document.querySelector(
                `select[data-subject="${a.subject}"]`
              );
              if (!sel) return;
              sel.value = first;
              moveOptionToTop(sel, first);
              if (second) {
                const cb = sel.parentElement.querySelector(
                  "input[type=checkbox]"
                );
                const div = sel.parentElement.querySelector(
                  ".additional-faculties"
                );
                const extra = div.querySelector("select");
                cb.checked = true;
                div.style.display = "block";
                extra.value = second;
                moveOptionToTop(extra, second);
              }
            });
          });
      }

      function moveOptionToTop(selectElem, val) {
        const opts = Array.from(selectElem.options);
        const idx = opts.findIndex((o) => o.value === val);
        if (idx > 1) {
          const opt = opts[idx];
          selectElem.remove(idx);
          selectElem.add(opt, selectElem.options[1]);
        }
      }

      function toggleAdditionalFaculty(cb) {
        const div = cb.nextElementSibling.nextElementSibling;
        if (cb.checked) div.style.display = "block";
        else {
          div.style.display = "none";
          div.querySelector("select").value = "";
        }
      }

      function saveAssignments() {
        const p = new URLSearchParams(location.search);
        const payload = [];
        document.querySelectorAll("#assignTable tbody tr").forEach((tr) => {
          const subj = tr.cells[0].textContent;
          const sel = tr.querySelector("select[data-subject]");
          const cb = tr.querySelector("input[type=checkbox]");
          const extra = tr.querySelector(".additional-faculties select");
          if (!sel.value) return;
          let fac = sel.value;
          if (cb.checked && extra.value) fac += "," + extra.value;
          payload.push({
            semester: p.get("semester"),
            class: p.get("class"),
            department: p.get("department"),
            room: p.get("room"),
            subject: subj,
            faculty: fac,
          });
        });
        fetch("save_assignments.php", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        })
          .then((r) => r.json())
          .then((res) =>
            alert(res.success ? "Saved successfully!" : "Failed to save.")
          )
          .catch(console.error);
      }

      function goBack() {
        location.href = `hodCT1.html${location.search}`;
      }
      function logout() {
        if (confirm("Are you sure you want to logout?")) {
          // Example: clear session storage or cookies if used
          // sessionStorage.clear();
          // Redirect to login or homepage
          window.location.href = "adlogin.html"; // change this to your actual login page
        }
      }
    </script>
  </body>
</html>
