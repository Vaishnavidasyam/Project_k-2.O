<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timetable Selection</title>
    <link rel="stylesheet" href="styles6.css" />
    <link rel="icon" href="pic.png" type="image/png" />
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background-image: url("back.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
      }

      /* Header */
      .header {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 5%;
        background-color: gray; /* plain gray header */
        box-shadow: 0 4px 6px #f9f9f91a;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1000;
      }

      .logo {
        display: flex;
        align-items: center;
        font-size: 1.5em;
        color: white;
      }
      .logo-icon {
        height: 40px;
        margin-right: 10px;
        background: none;
      }
      /* Navigation */
      .nav-links {
        display: flex;
        gap: 30px;
      }

      .nav-links a:hover {
        color: #333333a9;
      }
      .nav-links a {
        color: white;
        text-decoration: none;
        margin-left: 15px;
        font-weight: bold;
        cursor: pointer;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        border-radius: 10px;
        width: 80%;
        max-width: 500px;
        position: relative;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      }

      .close {
        position: absolute;
        right: 20px;
        top: 10px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        color: #888;
      }

      .close:hover {
        color: black;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <img src="icon.png" alt="Logo" class="logo-icon" />
        ğ‘¼ğ’ğ’Šğ’—ğ’†ğ’“ğ’”ğ’Šğ’•ğ’š ğ‘´ğ’‚ğ’ğ’‚ğ’ˆğ’†ğ’ğ’†ğ’ğ’• ğ‘ºğ’šğ’”ğ’•ğ’†ğ’
      </div>
      <nav class="nav-links">
        <a href="first.html">ğ‘¯ğ’ğ’ğ’†</a>
        <a onclick="showAbout()">ğ‘¨ğ’ƒğ’ğ’–ğ’•</a>
        <a onclick="showContact()">ğ‘ªğ’ğ’ğ’•ğ’‚ğ’„ğ’•</a>
        <a onclick="logout()">ğ‘³ğ’ğ’ˆğ’ğ’–ğ’•</a>
      </nav>
    </header>

    <!-- About Modal -->
    <div id="aboutModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('aboutModal')">&times;</span>
        <h2>ğ‘¨ğ’ƒğ’ğ’–ğ’• ğ‘»ğ’‰ğ’Šğ’” ğ‘¾ğ’†ğ’ƒğ’”ğ’Šğ’•ğ’†</h2>
        <p>
          ğ™ğ™ğ™¢ğ™šğ™ğ™–ğ™—ğ™¡ğ™š ğ™ˆğ™–ğ™£ğ™–ğ™œğ™šğ™¢ğ™šğ™£ğ™© ğ™ğ™®ğ™¨ğ™©ğ™šğ™¢ ğ™¨ğ™ğ™¢ğ™¥ğ™¡ğ™ğ™›ğ™ğ™šğ™¨ ğ™©ğ™ğ™š ğ™¥ğ™§ğ™¤ğ™˜ğ™šğ™¨ğ™¨ ğ™¤ğ™› ğ™©ğ™ğ™¢ğ™šğ™©ğ™–ğ™—ğ™¡ğ™š
          ğ™˜ğ™§ğ™šğ™–ğ™©ğ™ğ™¤ğ™£ ğ™–ğ™£ğ™™ ğ™šğ™£ğ™ğ™–ğ™£ğ™˜ğ™šğ™¨ ğ™©ğ™ğ™š ğ™¤ğ™«ğ™šğ™§ğ™–ğ™¡ğ™¡ ğ™–ğ™˜ğ™–ğ™™ğ™šğ™¢ğ™ğ™˜ ğ™šğ™­ğ™¥ğ™šğ™§ğ™ğ™šğ™£ğ™˜ğ™š ğ™›ğ™¤ğ™§ ğ™¨ğ™©ğ™ªğ™™ğ™šğ™£ğ™©ğ™¨ ğ™–ğ™£ğ™™
          ğ™›ğ™–ğ™˜ğ™ªğ™¡ğ™©ğ™®. ğ™ğ™ğ™ğ™¨ ğ™¥ğ™–ğ™œğ™š ğ™¨ğ™šğ™§ğ™«ğ™šğ™¨ ğ™–ğ™¨ ğ™©ğ™ğ™š ğ™¨ğ™©ğ™–ğ™§ğ™©ğ™ğ™£ğ™œ ğ™ğ™£ğ™©ğ™šğ™§ğ™›ğ™–ğ™˜ğ™š ğ™¬ğ™ğ™©ğ™ ğ™£ğ™–ğ™«ğ™ğ™œğ™–ğ™©ğ™ğ™¤ğ™£
          ğ™–ğ™£ğ™™ ğ™–ğ™ªğ™©ğ™ğ™šğ™£ğ™©ğ™ğ™˜ğ™–ğ™©ğ™ğ™¤ğ™£ ğ™›ğ™šğ™–ğ™©ğ™ªğ™§ğ™šğ™¨.
        </p>
      </div>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal('contactModal')">&times;</span>
        <h2>ğ‘ªğ’ğ’ğ’•ğ’‚ğ’„ğ’• ğ‘¼ğ’”</h2>
        <p>
          <strong>ğ‘¬ğ’ğ’‚ğ’Šğ’:</strong> ğ’”ğ’‰ğ’‚ğ’Šğ’Œğ’‡ğ’‚ğ’šğ’‚ğ’›73822@ğ’ˆğ’ğ’‚ğ’Šğ’.ğ’„ğ’ğ’<br />
          <strong>ğ‘·ğ’‰ğ’ğ’ğ’†:</strong> 7382259565<br />
          <strong>ğ‘¨ğ’…ğ’…ğ’“ğ’†ğ’”ğ’”:</strong> ğ‘²ğ’–ğ’Œğ’‚ğ’•ğ’‘ğ’‚ğ’ğ’ğ’š, ğ‘¯ğ’šğ’…ğ’†ğ’“ğ’‚ğ’ƒğ’‚ğ’…, ğ‘°ğ’ğ’…ğ’Šğ’‚<br />
          <strong>ğ‘­ğ’ğ’ğ’ğ’ğ’˜ ğ’–ğ’”:</strong> ğ‘­ğ’‚ğ’„ğ’†ğ’ƒğ’ğ’ğ’Œ | ğ‘»ğ’˜ğ’Šğ’•ğ’•ğ’†ğ’“ | ğ‘°ğ’ğ’”ğ’•ğ’‚ğ’ˆğ’“ğ’‚ğ’
        </p>
      </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
      <div class="form-box">
        <h2>ğ‘ºğ’†ğ’ğ’†ğ’„ğ’• ğ‘«ğ’†ğ’•ğ’‚ğ’Šğ’ğ’” ğ’‡ğ’ğ’“ ğ‘»ğ’Šğ’ğ’†ğ’•ğ’‚ğ’ƒğ’ğ’†</h2>
        <form id="timetableForm">
          <div class="form-group">
            <label for="semester">ğ‘ºğ’†ğ’ğ’†ğ’”ğ’•ğ’†ğ’“</label>
            <select id="semester" required>
              <option value="">ğ‘ºğ’†ğ’ğ’†ğ’„ğ’• ğ’”ğ’†ğ’ğ’†ğ’”ğ’•ğ’†ğ’“</option>
              <option value="1-1">1-1</option>
              <option value="1-2">1-2</option>
              <option value="2-1">2-1</option>
              <option value="2-2">2-2</option>
              <option value="3-1">3-1</option>
              <option value="3-2">3-2</option>
              <option value="4-1">4-1</option>
              <option value="4-2">4-2</option>
            </select>
          </div>

          <div class="form-group">
            <label for="class">ğ‘ªğ’ğ’‚ğ’”ğ’”</label>
            <select id="class" required>
              <option value="">ğ‘ºğ’†ğ’ğ’†ğ’„ğ’• ğ‘ªğ’ğ’‚ğ’”ğ’”</option>
              <option value="Regular">Regular</option>
              <option value="IDP">IDP</option>
              <option value="IDDMP">IDDMP</option>
            </select>
          </div>

          <div class="form-group">
            <label for="room">ğ‘ºğ’†ğ’ğ’†ğ’„ğ’• ğ‘¹ğ’ğ’ğ’</label>
            <select id="room" required>
              <option value="">ğ‘ºğ’†ğ’ğ’†ğ’„ğ’• ğ‘¹ğ’ğ’ğ’</option>
              <!-- G1 to G11 -->
              <option value="G1">G1</option>
              <option value="G2">G2</option>
              <option value="G3">G3</option>
              <option value="G4">G4</option>
              <option value="G5">G5</option>
              <option value="G6">G6</option>
              <option value="G7">G7</option>
              <option value="G8">G8</option>
              <option value="G9">G9</option>
              <option value="G10">G10</option>
              <option value="G11">G11</option>
              <!-- 101 to 110 -->
              <option value="101">101</option>
              <option value="102">102</option>
              <option value="103">103</option>
              <option value="104">104</option>
              <option value="105">105</option>
              <option value="106">106</option>
              <option value="107">107</option>
              <option value="108">108</option>
              <option value="109">109</option>
              <option value="110">110</option>
              <!-- 201 to 210 -->
              <option value="201">201</option>
              <option value="202">202</option>
              <option value="203">203</option>
              <option value="204">204</option>
              <option value="205">205</option>
              <option value="206">206</option>
              <option value="207">207</option>
              <option value="208">208</option>
              <option value="209">209</option>
              <option value="210">210</option>
            </select>
          </div>

          <div class="button-group">
            <button
              type="button"
              class="cancel-btn"
              onclick="window.location.href='first.html'"
            >
              ğ‘ªğ’‚ğ’ğ’„ğ’†ğ’ <img src="cancel.png" alt="Cancel Icon" class="btn-icon" />
            </button>

            <button type="submit" class="next-btn">
              ğ‘µğ’†ğ’™ğ’• <img src="signin.png" alt="Next Icon" class="btn-icon" />
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Modal controls
      function showAbout() {
        document.getElementById("aboutModal").style.display = "block";
      }
      function showContact() {
        document.getElementById("contactModal").style.display = "block";
      }
      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }
      window.onclick = function (event) {
        if (event.target.classList.contains("modal")) {
          event.target.style.display = "none";
        }
      };

      // Extract department from URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const department = urlParams.get("department");

      // Event listener for form submission
      document
        .getElementById("timetableForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const semester = document.getElementById("semester").value;
          const classValue = document.getElementById("class").value;
          const room = document.getElementById("room").value;

          if (!semester || !classValue || !room) {
            alert("Please select all fields!");
            return;
          }
          fetch(
            `check_log.php?semester=${encodeURIComponent(
              semester
            )}&class=${encodeURIComponent(
              classValue
            )}&room=${encodeURIComponent(room)}`
          )
            .then((response) => response.json())
            .then((data) => {
              if (data.exact_match) {
                window.location.href = `hodCT1.html?semester=${encodeURIComponent(
                  semester
                )}&class=${encodeURIComponent(
                  classValue
                )}&room=${encodeURIComponent(
                  room
                )}&department=${encodeURIComponent(department)}`;
              } else if (data.room_conflict) {
                alert(
                  "This room is already assigned to another semester/class. Please select a different room."
                );
              } else if (data.semclass_conflict) {
                alert(
                  "This semester/class is already assigned to another room. Please select a different combination."
                );
              } else {
                // Proceed to insert
                const formData = new FormData();
                formData.append("semester", semester);
                formData.append("class", classValue);
                formData.append("room", room);
                formData.append("department", department);

                fetch("insert_log.php", {
                  method: "POST",
                  body: formData,
                })
                  .then((response) => response.text())
                  .then((result) => {
                    if (result.trim() === "success") {
                      window.location.href = `hodCT1.html?semester=${encodeURIComponent(
                        semester
                      )}&class=${encodeURIComponent(
                        classValue
                      )}&room=${encodeURIComponent(
                        room
                      )}&department=${encodeURIComponent(department)}`;
                    } else {
                      alert("Error saving data to log!");
                    }
                  })
                  .catch((error) => {
                    console.error("Insert Error:", error);
                    alert("Something went wrong during insertion.");
                  });
              }
            })
            .catch((error) => {
              console.error("Fetch Error:", error);
              alert("Failed to check log. Please try again.");
            });
        });
      function logout() {
        if (confirm("Are you sure you want to logout?")) {
          // Example: clear session storage or cookies if used
          // sessionStorage.clear();
          // Redirect to login or homepage
          window.location.href = "adlogin.html"; // change this to your actual login page
        }
      }
      document.addEventListener("DOMContentLoaded", function () {
        // Save the full URL to localStorage when HOD log page is opened
        localStorage.setItem("hodlog_url", window.location.href);
      });
    </script>
  </body>
</html>
